#!/bin/bash

#=============================================================================
# КОНФИГУРАЦИОННЫЙ ФАЙЛ ДЛЯ АВТОМАТИЧЕСКОГО ДЕПЛОЯ
# Проект: GoGoMarket (Flutter Web Application)
# Репозиторий: buranovt2025-jpg/video-marketplace-app
#=============================================================================

#-----------------------------------------------------------------------------
# НАСТРОЙКИ СЕРВЕРА DIGITAL OCEAN
#-----------------------------------------------------------------------------

# IP адрес сервера
export SERVER_IP="165.232.81.31"

# Пользователь на сервере (обычно root для Digital Ocean)
export SERVER_USER="root"

# Порт SSH (по умолчанию 22)
export SSH_PORT="22"

# Путь к директории с веб-приложением на сервере
export SERVER_WEB_DIR="/var/www/html"

# Путь к конфигурации nginx на сервере
export NGINX_CONFIG="/etc/nginx/sites-available/default"

#-----------------------------------------------------------------------------
# НАСТРОЙКИ ЛОКАЛЬНОГО ПРОЕКТА
#-----------------------------------------------------------------------------

# Путь к директории проекта (по умолчанию - родительская директория)
# ВАЖНО: Измените этот путь на фактический путь к вашему проекту!
export PROJECT_DIR="/home/ubuntu/video-marketplace-app"

# Путь к директории с билдом Flutter web
export BUILD_DIR="${PROJECT_DIR}/build/web"

# Ветка для деплоя (main, production, develop и т.д.)
export DEPLOY_BRANCH="main"

#-----------------------------------------------------------------------------
# НАСТРОЙКИ FLUTTER BUILD
#-----------------------------------------------------------------------------

# Команда для билда Flutter web приложения
export FLUTTER_BUILD_CMD="flutter build web --release"

# Дополнительные флаги для билда (например, --web-renderer html или canvaskit)
export FLUTTER_BUILD_FLAGS="--web-renderer canvaskit"

# Очистка перед билдом (true/false)
export CLEAN_BEFORE_BUILD="true"

#-----------------------------------------------------------------------------
# НАСТРОЙКИ SSH
#-----------------------------------------------------------------------------

# Путь к SSH ключу (если не используется стандартный ~/.ssh/id_rsa)
# Оставьте пустым для использования стандартного ключа
export SSH_KEY_PATH=""

# Имя SSH хоста из ~/.ssh/config (если настроено)
# Если настроено, будет использоваться вместо SERVER_IP
export SSH_HOST_ALIAS="gogomarket"

#-----------------------------------------------------------------------------
# НАСТРОЙКИ ЛОГИРОВАНИЯ
#-----------------------------------------------------------------------------

# Директория для логов
export LOG_DIR="${HOME}/cursor_deploy_automation/logs"

# Имя файла лога (будет добавлена временная метка)
export LOG_FILE="deploy"

# Максимальное количество старых логов для хранения
export MAX_LOGS="10"

#-----------------------------------------------------------------------------
# НАСТРОЙКИ РЕЗЕРВНОГО КОПИРОВАНИЯ
#-----------------------------------------------------------------------------

# Создавать резервную копию перед деплоем (true/false)
export CREATE_BACKUP="true"

# Директория для резервных копий
export BACKUP_DIR="${HOME}/cursor_deploy_automation/backups"

# Максимальное количество резервных копий для хранения
export MAX_BACKUPS="5"

#-----------------------------------------------------------------------------
# НАСТРОЙКИ УВЕДОМЛЕНИЙ
#-----------------------------------------------------------------------------

# Email для уведомлений об ошибках (оставьте пустым для отключения)
export NOTIFICATION_EMAIL=""

# Webhook URL для Slack/Discord уведомлений (оставьте пустым для отключения)
export WEBHOOK_URL=""

#-----------------------------------------------------------------------------
# ДОПОЛНИТЕЛЬНЫЕ НАСТРОЙКИ
#-----------------------------------------------------------------------------

# Проверять изменения перед деплоем (true/false)
# Если true, деплой произойдет только при наличии новых коммитов
export CHECK_CHANGES="true"

# Запускать тесты перед деплоем (true/false)
export RUN_TESTS="false"

# Команда для запуска тестов
export TEST_CMD="flutter test"

# Перезапускать nginx после деплоя (true/false)
export RESTART_NGINX="true"

# Очищать кэш браузера (добавлять версию к файлам)
export CACHE_BUST="true"

#-----------------------------------------------------------------------------
# ЦВЕТА ДЛЯ ВЫВОДА В КОНСОЛЬ
#-----------------------------------------------------------------------------

export COLOR_RESET="\033[0m"
export COLOR_RED="\033[0;31m"
export COLOR_GREEN="\033[0;32m"
export COLOR_YELLOW="\033[0;33m"
export COLOR_BLUE="\033[0;34m"
export COLOR_PURPLE="\033[0;35m"
export COLOR_CYAN="\033[0;36m"
export COLOR_WHITE="\033[0;37m"

#-----------------------------------------------------------------------------
# КОНЕЦ КОНФИГУРАЦИИ
#-----------------------------------------------------------------------------

# Вывод информации о загрузке конфигурации
if [ "${1}" != "silent" ]; then
    echo -e "${COLOR_GREEN}✓ Конфигурация загружена${COLOR_RESET}"
    echo -e "${COLOR_CYAN}  Сервер: ${SERVER_USER}@${SERVER_IP}${COLOR_RESET}"
    echo -e "${COLOR_CYAN}  Проект: ${PROJECT_DIR}${COLOR_RESET}"
    echo -e "${COLOR_CYAN}  Ветка: ${DEPLOY_BRANCH}${COLOR_RESET}"
fi
