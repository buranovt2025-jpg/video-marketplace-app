# Техническое задание: Video Marketplace App

**Версия:** 1.0  
**Дата:** 22 декабря 2024  
**Статус:** Утверждено

---

## 1. Общие сведения

### 1.1 Цель проекта

Создание современной мобильной платформы видео-маркетплейса, где пользователи могут:
- Просматривать короткие видео-обзоры товаров
- Покупать товары непосредственно из видео
- Продавцы могут продвигать свои товары через видео-контент

Концепция объединяет развлекательный формат TikTok с функционалом e-commerce (TikTok Shop).

### 1.2 Целевая аудитория

**Покупатели:**
- Возраст: 18-45 лет
- Активные пользователи социальных сетей
- Предпочитают визуальный контент
- Совершают импульсивные покупки

**Продавцы:**
- Малый и средний бизнес
- Инфлюенсеры и контент-криейторы
- Производители товаров
- Дропшипперы

### 1.3 Базовая платформа

Проект базируется на TikTok Flutter клоне со следующим стеком:
- **Frontend:** Flutter (Dart)
- **Backend:** Firebase (Auth, Firestore, Storage)
- **State Management:** GetX
- **Архитектура:** MVC (Model-View-Controller)

---

## 2. Функциональные требования

### 2.1 Модуль аутентификации

#### 2.1.1 Регистрация пользователей
- Регистрация через email и пароль
- Регистрация через Google (OAuth)
- Регистрация через Apple (iOS)
- Валидация email
- Проверка сложности пароля (минимум 8 символов)
- Подтверждение email

#### 2.1.2 Вход в систему
- Вход через email/пароль
- Вход через Google
- Вход через Apple
- Функция "Запомнить меня"
- Восстановление пароля

#### 2.1.3 Профиль пользователя
- Редактирование профиля (имя, фото, био)
- Изменение пароля
- Настройки приватности
- Выход из системы
- Удаление аккаунта

### 2.2 Модуль видео (базовый функционал)

#### 2.2.1 Просмотр видео
- Вертикальная прокрутка видео (TikTok-стиль)
- Автовоспроизведение видео
- Пауза/воспроизведение по тапу
- Регулировка громкости
- Счётчики просмотров

#### 2.2.2 Загрузка видео
- Выбор видео из галереи
- Запись видео через камеру
- Обрезка видео
- Добавление описания
- Добавление хэштегов
- **[НОВОЕ]** Привязка товаров к видео

#### 2.2.3 Взаимодействие с видео
- Лайки
- Комментарии
- Поделиться
- Сохранить в избранное
- Пожаловаться

### 2.3 Модуль социальных функций

#### 2.3.1 Подписки
- Подписка на пользователей
- Отписка от пользователей
- Лента подписок
- Список подписчиков
- Список подписок

#### 2.3.2 Поиск
- Поиск пользователей
- **[НОВОЕ]** Поиск товаров
- Поиск по хэштегам
- История поиска
- Популярные запросы

#### 2.3.3 Уведомления
- Уведомления о новых подписчиках
- Уведомления о лайках
- Уведомления о комментариях
- **[НОВОЕ]** Уведомления о заказах
- Push-уведомления

### 2.4 Модуль маркетплейса (НОВЫЙ)

#### 2.4.1 Каталог товаров
- Список товаров с фильтрацией
- Категории товаров (одежда, электроника, красота, дом, и т.д.)
- Фильтры:
  - По цене (от-до)
  - По категории
  - По рейтингу
  - По наличию
- Сортировка:
  - По популярности
  - По цене (возрастание/убывание)
  - По новизне
  - По рейтингу

#### 2.4.2 Страница товара
- Галерея изображений товара (свайп)
- Название и описание
- Цена (текущая, старая, скидка)
- Рейтинг и количество отзывов
- Информация о продавце
- Наличие на складе
- Характеристики товара
- Кнопка "Добавить в корзину"
- Кнопка "Купить сейчас"
- Список видео с этим товаром

#### 2.4.3 Интеграция товаров в видео
- Отображение товаров в видео (overlay внизу экрана)
- Клик на товар → переход на страницу товара
- Добавление товара в корзину из видео
- Список всех товаров, показанных в видео
- Теги товаров в описании видео

#### 2.4.4 Корзина покупок
- Список товаров в корзине
- Изменение количества товаров
- Удаление товаров
- Расчёт общей стоимости
- Расчёт стоимости доставки
- Применение промокодов
- Кнопка "Оформить заказ"

#### 2.4.5 Оформление заказа
- Ввод адреса доставки
- Выбор способа доставки
- Выбор способа оплаты
- Итоговая стоимость
- Подтверждение заказа

#### 2.4.6 Оплата
- Интеграция Stripe
  - Оплата картой (Visa, Mastercard, AmEx)
  - Apple Pay
  - Google Pay
- Альтернатива: PayPal
- Безопасное хранение платёжных данных
- 3D Secure аутентификация

#### 2.4.7 Заказы
- История заказов
- Детали заказа:
  - Список товаров
  - Адрес доставки
  - Статус заказа
  - Трек-номер
- Статусы заказа:
  - Новый
  - Оплачен
  - Обрабатывается
  - Отправлен
  - В пути
  - Доставлен
  - Отменён
- Отслеживание доставки
- Отмена заказа (если не отправлен)

#### 2.4.8 Отзывы и рейтинги
- Просмотр отзывов о товаре
- Добавление отзыва (после покупки)
- Оценка товара (1-5 звёзд)
- Загрузка фото к отзыву
- Лайки к отзывам
- Сортировка отзывов (по дате, по рейтингу)

### 2.5 Модуль для продавцов (НОВЫЙ)

#### 2.5.1 Регистрация продавца
- Форма регистрации продавца
- Поля:
  - Название компании
  - ИНН/ОГРН
  - Юридический адрес
  - Контактное лицо
  - Телефон
  - Email
- Загрузка документов (сканы)
- Отправка на модерацию

#### 2.5.2 Модерация продавцов (Admin)
- Список заявок на модерации
- Просмотр данных продавца
- Просмотр документов
- Одобрение/отклонение заявки
- Комментарий при отклонении

#### 2.5.3 Личный кабинет продавца
- Dashboard с ключевыми метриками:
  - Продажи за день/неделю/месяц
  - Количество заказов
  - Средний чек
  - Конверсия
- Быстрый доступ к разделам:
  - Товары
  - Заказы
  - Финансы
  - Аналитика

#### 2.5.4 Управление товарами
- Список товаров продавца
- Добавление товара:
  - Название
  - Описание
  - Категория
  - Цена
  - Старая цена (для скидок)
  - Количество на складе
  - Характеристики (размер, цвет, и т.д.)
  - Загрузка изображений (до 10 шт)
- Редактирование товара
- Удаление товара
- Массовые операции (удаление, изменение цены)
- Импорт товаров из CSV/Excel

#### 2.5.5 Управление заказами
- Список заказов продавца
- Фильтры по статусу
- Детали заказа
- Изменение статуса заказа
- Добавление трек-номера
- Печать накладной
- Уведомление покупателя об изменении статуса

#### 2.5.6 Финансы
- Баланс продавца
- История транзакций
- Запрос на вывод средств
- Реквизиты для выплат
- Комиссия платформы

#### 2.5.7 Аналитика продаж
- График продаж (день/неделя/месяц/год)
- Топ товаров по продажам
- Топ товаров по просмотрам
- Конверсия (просмотры → покупки)
- Средний чек
- Возвраты и отмены
- Экспорт данных (CSV, Excel, PDF)

### 2.6 Модуль администратора

#### 2.6.1 Управление пользователями
- Список пользователей
- Блокировка/разблокировка пользователей
- Удаление пользователей
- Просмотр активности пользователя

#### 2.6.2 Модерация контента
- Список видео на модерации
- Просмотр видео
- Одобрение/отклонение видео
- Удаление видео
- Блокировка за нарушения

#### 2.6.3 Управление категориями
- Список категорий товаров
- Добавление категории
- Редактирование категории
- Удаление категории

#### 2.6.4 Аналитика платформы
- Общее количество пользователей
- Активные пользователи (DAU, MAU)
- Количество видео
- Количество товаров
- Количество заказов
- Общий оборот
- Комиссия платформы

---

## 3. Нефункциональные требования

### 3.1 Производительность

- Время загрузки приложения: < 3 секунд
- Время загрузки видео: < 2 секунд
- Плавная прокрутка видео (60 FPS)
- Поддержка до 10,000 одновременных пользователей
- Время отклика API: < 500 мс

### 3.2 Масштабируемость

- Горизонтальное масштабирование backend
- CDN для доставки видео и изображений
- Кэширование часто запрашиваемых данных
- Оптимизация запросов к базе данных

### 3.3 Безопасность

- HTTPS для всех соединений
- Шифрование чувствительных данных
- Защита от SQL-инъекций и XSS
- Firestore Security Rules
- Валидация данных на клиенте и сервере
- PCI DSS compliance для платежей
- Двухфакторная аутентификация (опционально)

### 3.4 Доступность

- Доступность сервиса: 99.9% (uptime)
- Резервное копирование данных (ежедневно)
- Disaster recovery план
- Мониторинг и алертинг

### 3.5 Совместимость

**Android:**
- Минимальная версия: Android 6.0 (API 23)
- Целевая версия: Android 14 (API 34)

**iOS:**
- Минимальная версия: iOS 12.0
- Целевая версия: iOS 17

**Web (опционально):**
- Chrome 90+
- Safari 14+
- Firefox 88+
- Edge 90+

### 3.6 Локализация

- Поддержка языков:
  - Русский (основной)
  - Английский
  - Узбекский (опционально)
- Локализация UI
- Локализация контента
- Поддержка RTL (для будущих языков)

### 3.7 Оффлайн режим

- Кэширование просмотренных видео
- Кэширование данных профиля
- Синхронизация при восстановлении соединения
- Уведомление об отсутствии интернета

---

## 4. Технические требования

### 4.1 Frontend (Flutter)

**Зависимости:**
- `flutter_sdk: ^3.0.0`
- `get: ^4.6.5` (State Management)
- `firebase_core: ^2.15.0`
- `firebase_auth: ^4.7.0`
- `cloud_firestore: ^4.8.0`
- `firebase_storage: ^11.2.0`
- `video_player: ^2.7.0`
- `image_picker: ^1.0.0`
- `cached_network_image: ^3.2.3`
- `flutter_stripe: ^9.3.0` (для оплаты)
- `http: ^1.1.0`

**Архитектура:**
- MVC (Model-View-Controller)
- Разделение на модули (auth, video, marketplace, seller)
- Dependency Injection через GetX

**UI/UX:**
- Material Design 3
- Адаптивный дизайн (телефоны, планшеты)
- Тёмная тема (опционально)
- Анимации и переходы

### 4.2 Backend (Firebase)

**Firebase Authentication:**
- Email/Password
- Google Sign-In
- Apple Sign-In (iOS)

**Cloud Firestore:**
- Коллекции:
  - `users` (пользователи)
  - `videos` (видео)
  - `products` (товары)
  - `categories` (категории)
  - `orders` (заказы)
  - `reviews` (отзывы)
  - `sellers` (продавцы)
  - `carts` (корзины)
- Индексы для оптимизации запросов
- Security Rules для защиты данных

**Firebase Storage:**
- Хранение видео
- Хранение изображений товаров
- Хранение аватаров пользователей
- Организация по папкам

**Firebase Cloud Messaging:**
- Push-уведомления
- Уведомления о заказах
- Уведомления о новых подписчиках

**Firebase Analytics:**
- Отслеживание событий
- Воронка конверсии
- Retention анализ

### 4.3 Платёжная система

**Stripe:**
- Stripe SDK для Flutter
- Payment Intents API
- Webhooks для обработки событий
- Тестовый режим для разработки
- Production режим для запуска

**Альтернатива: PayPal**

### 4.4 Инфраструктура

**Хостинг:**
- Firebase Hosting (для web-версии)
- Cloud Functions (для серверной логики)

**CDN:**
- Firebase Storage CDN
- Cloudflare (опционально)

**Мониторинг:**
- Firebase Crashlytics (отслеживание ошибок)
- Firebase Performance Monitoring
- Google Analytics

---

## 5. Модели данных

### 5.1 User (Пользователь)

```dart
class User {
  String uid;
  String email;
  String name;
  String? photoUrl;
  String? bio;
  int followersCount;
  int followingCount;
  int likesCount;
  List<String> followers;
  List<String> following;
  bool isSeller;
  DateTime createdAt;
}
```

### 5.2 Video (Видео)

```dart
class Video {
  String id;
  String uid; // ID пользователя
  String videoUrl;
  String? thumbnailUrl;
  String caption;
  List<String> hashtags;
  List<String> productIds; // [НОВОЕ] Привязанные товары
  int likesCount;
  int commentsCount;
  int sharesCount;
  int viewsCount;
  List<String> likes;
  DateTime createdAt;
}
```

### 5.3 Product (Товар)

```dart
class Product {
  String id;
  String sellerId;
  String name;
  String description;
  double price;
  double? oldPrice;
  String categoryId;
  List<String> imageUrls;
  int stockQuantity;
  double rating;
  int reviewsCount;
  int salesCount;
  Map<String, dynamic> attributes; // размер, цвет, и т.д.
  bool isActive;
  DateTime createdAt;
}
```

### 5.4 Category (Категория)

```dart
class Category {
  String id;
  String name;
  String? iconUrl;
  int productsCount;
}
```

### 5.5 Cart (Корзина)

```dart
class Cart {
  String userId;
  List<CartItem> items;
  double totalPrice;
  DateTime updatedAt;
}

class CartItem {
  String productId;
  int quantity;
  double price;
}
```

### 5.6 Order (Заказ)

```dart
class Order {
  String id;
  String userId;
  String sellerId;
  List<OrderItem> items;
  double totalPrice;
  double shippingCost;
  String shippingAddress;
  String status; // new, paid, processing, shipped, delivered, cancelled
  String? trackingNumber;
  String paymentMethod;
  String paymentId; // Stripe Payment Intent ID
  DateTime createdAt;
  DateTime? deliveredAt;
}

class OrderItem {
  String productId;
  String productName;
  int quantity;
  double price;
}
```

### 5.7 Review (Отзыв)

```dart
class Review {
  String id;
  String productId;
  String userId;
  String orderId;
  int rating; // 1-5
  String? comment;
  List<String>? photoUrls;
  int likesCount;
  DateTime createdAt;
}
```

### 5.8 Seller (Продавец)

```dart
class Seller {
  String id;
  String userId;
  String companyName;
  String inn;
  String address;
  String contactPerson;
  String phone;
  String email;
  String status; // pending, approved, rejected
  double balance;
  double totalSales;
  int productsCount;
  int ordersCount;
  DateTime createdAt;
  DateTime? approvedAt;
}
```

---

## 6. API Endpoints (Cloud Functions)

### 6.1 Платежи

- `POST /create-payment-intent` - Создание платёжного намерения
- `POST /webhook` - Webhook от Stripe

### 6.2 Заказы

- `POST /create-order` - Создание заказа после оплаты
- `PUT /update-order-status` - Обновление статуса заказа

### 6.3 Аналитика

- `GET /seller-analytics` - Получение аналитики продавца
- `GET /platform-analytics` - Получение аналитики платформы (admin)

---

## 7. Этапы разработки

### Этап 1: Подготовка (1-2 недели)
- Обновление зависимостей
- Настройка Firebase
- Тестирование базового функционала

### Этап 2: Маркетплейс (3-4 недели)
- Каталог товаров
- Корзина
- Оплата
- Заказы

### Этап 3: Продавцы (3-4 недели)
- Регистрация продавцов
- Личный кабинет
- Управление товарами
- Аналитика

### Этап 4: Улучшения (4-6 недель)
- Рекомендации
- Live-трансляции
- Чат
- Отзывы

### Этап 5: Запуск (2-3 недели)
- Тестирование
- Публикация в сторах
- Мониторинг

**Общая длительность:** 13-19 недель (3-5 месяцев)

---

## 8. Критерии приёмки

### 8.1 Функциональность
- ✅ Все функции из ТЗ реализованы
- ✅ Нет критических багов
- ✅ Успешное прохождение тестов

### 8.2 Производительность
- ✅ Время загрузки < 3 сек
- ✅ Плавная прокрутка видео
- ✅ Время отклика API < 500 мс

### 8.3 Безопасность
- ✅ HTTPS везде
- ✅ Firestore Security Rules настроены
- ✅ Платежи через Stripe (PCI DSS)

### 8.4 Публикация
- ✅ Приложение опубликовано в Google Play
- ✅ Приложение опубликовано в App Store
- ✅ Рейтинг > 4.0

---

## 9. Риски и ограничения

### 9.1 Риски

1. **Технические:**
   - Проблемы с производительностью при большом количестве видео
   - Ограничения Firebase (квоты, стоимость)
   - Сложности интеграции платёжных систем

2. **Бизнес:**
   - Низкая конверсия покупателей
   - Недостаток продавцов
   - Высокая стоимость привлечения пользователей

3. **Юридические:**
   - Необходимость лицензий для продажи определённых товаров
   - Соблюдение законов о защите данных (GDPR, и т.д.)

### 9.2 Ограничения

- Бюджет: TBD
- Команда: 1-2 разработчика
- Срок: 3-5 месяцев
- Первая версия: MVP с базовым функционалом

---

## 10. Поддержка и развитие

### 10.1 Техническая поддержка
- Мониторинг ошибок (Crashlytics)
- Быстрое реагирование на критические баги
- Регулярные обновления

### 10.2 Развитие продукта
- Сбор обратной связи от пользователей
- Анализ метрик
- Итерации на основе данных
- Добавление новых функций

---

**Документ подготовлен:** 22 декабря 2024  
**Версия:** 1.0  
**Статус:** Утверждено
