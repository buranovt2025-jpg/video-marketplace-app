# Журнал разработки Video Marketplace App

## Сессия 30 декабря 2025

### Контекст
- Работа велась в облачном окружении, где **нет установленного Flutter/Dart SDK**, поэтому запуск `flutter analyze`/`flutter test` был недоступен.

### Что проверили
- Сверили журнал с git-историей: коммиты из записи 28.12.2024 **присутствуют** в текущей ветке:
  - `00a099d` — push-уведомления + геолокация/расстояние/навигация
  - `308c240` — тариф доставки + таймер принятия заказа
  - `3e9953e` — кабинеты по ролям + переключение языка

### Что сделали (код)
- Убрали потенциальные крэши из-за `!` (force unwrap) в UI:
  - `lib/views/screens/common/location_picker_screen.dart` — безопасная инициализация `initialAddress/initialLatitude/initialLongitude` без `!`
  - `lib/views/screens/seller/create_product_screen.dart` — обработка `DropdownButton.onChanged` без `value!` (guard на `null`)

### Принятые решения (почему так)
- **Не меняли поведение**, только повысили стабильность: заменили force-unwrap на безопасные проверки `null`.
- **Не трогали зависимости/архитектуру**, так как цель — минимальные, низкорисковые правки без прогонов Flutter-инструментов в этом окружении.

### Что осталось сделать (следующие шаги)
- Запустить локально (в окружении с Flutter):
  - `flutter pub get`
  - `flutter analyze`
  - `flutter test`
- По желанию: сделать быстрый аудит проекта на оставшиеся force-unwrap `!` и небезопасные места (особенно вокруг auth/user и Firestore `.data()`).

## Сессия 28 декабря 2024

### Обсуждение концепции проекта

**Концепция:** Платформа для оптовых рынков города. Продавцы с рынков выставляют товары, покупатели заказывают, курьеры доставляют напрямую (как доставка еды).

**4 роли в системе:**
1. **Продавец** - выставляет рилсы, истории, карточки товаров, общается с покупателями
2. **Покупатель** - смотрит контент, ищет товары, заказывает, отслеживает доставку
3. **Курьер** - видит заказы, забирает у продавца, доставляет покупателю
4. **Админ** - видит всё, модерирует, может создавать рилсы/истории для рекламы

### Ключевые решения

| Решение | Выбор | Причина |
|---------|-------|---------|
| Дизайн | Instagram-style | Кружочки историй, Explore-сетка в поиске |
| Оплата | Наличка курьеру (COD) | Простой старт, онлайн-оплата позже |
| Доставка | Только через курьеров | Не самовывоз |
| Чат | В приложении | Продавец <-> Покупатель |
| Локация | При регистрации | Клик -> навигатор (Google Maps/Yandex) |
| Статус заказа | Виден всем участникам | Прозрачность процесса |

### Технические решения

- **Frontend:** Flutter (один app с 4 ролями)
- **Backend:** DigitalOcean (App Platform + Spaces + Managed DB)
- **База данных:** PostgreSQL
- **Хранилище видео:** DigitalOcean Spaces

### Что сделано сегодня

1. Создан демо-режим для тестирования UI без Firebase
2. Обновлены зависимости для совместимости с Flutter SDK
3. Собран демо-APK (22.6 MB)
4. Согласован план MVP на 4-5 недель
5. Определены все роли и функционал

### Следующие шаги

1. Создать архитектуру базы данных
2. Настроить backend на DigitalOcean
3. Реализовать авторизацию с ролями
4. Начать разработку по ТЗ

---

## Сессия 28 декабря 2024 (продолжение) - Post-MVP улучшения

### Собранные требования по ролям

**ПРОДАВЕЦ:**
- Принять/отклонить заказ (кнопки) - ДА
- Статистика (выручка, топ товары) - ДА
- Управление остатками товара - ДА

**ПОКУПАТЕЛЬ:**
- Несколько адресов доставки (дом/работа) - ДА
- Избранное (сохранённые товары) - ДА
- Кнопка "Проблема с заказом" (жалоба) - ДА
- Убрать вкладку "Создать" - ДА

**КУРЬЕР:**
- Uber-принцип (сам берёт заказы) - ДА
- Онлайн-статус (на смене) - ДА
- Показывать заработок - ДА

**АДМИН:**
- Верификация продавцов (через админа) - ДА
- Уведомления о жалобах - ДА

### Дополнительные требования

- **Цвета:** Оранжевый (#FF6B00), Белый, Чёрный
- **Языки:** Узбекский, Русский, Английский
- **Кабинет:** Отдельный раздел в профиле
- **Тариф доставки:** Добавить позже
- **Таймер на принятие заказа:** Добавить позже
- **Push-уведомления:** Добавить позже
- **Геолокация с картой:** Добавить позже

### Главные экраны по ролям

**Покупатель:** Лента → Поиск → Заказы → Профиль (4 вкладки, без "Создать")
**Продавец:** Лента → Поиск → Создать → Заказы → Профиль (5 вкладок)
**Курьер:** Доступные → Активные → История → Профиль
**Админ:** Дашборд → Пользователи → Заказы → Контент

### Что сделано

1. Обновлена цветовая схема (оранжевый акцент)
2. Убрана вкладка "Создать" у покупателя
3. Добавлен EditProfileScreen с загрузкой аватара
4. Добавлен StoryViewerScreen для полноэкранного просмотра историй
5. Обновлено ТЗ с новыми требованиями
6. Добавлены кабинеты по ролям (SellerCabinet, BuyerCabinet)
7. Добавлена локализация (узб/рус/англ)
8. Добавлен тариф доставки (стандарт/экспресс)
9. Добавлен таймер на принятие заказа (5 минут)
10. Добавлены push-уведомления (NotificationService)
11. Добавлена геолокация с расчётом расстояния (LocationService)
12. Курьер видит расстояние до продавца/покупателя
13. Кнопка навигации открывает Google Maps/Яндекс Карты

### Коммиты

- `00a099d` - Add push notifications and geolocation with distance calculation and navigation
- `308c240` - Add delivery tariff and order acceptance timer
- `3e9953e` - Add role-specific cabinet screens with localization

---

## Предыдущие сессии

### 24 декабря 2024
- Исправлена загрузка видео (null-safety, обработка ошибок)
- Исправлен просмотр профиля (проверки авторизации)
- Добавлены snackbar уведомления об ошибках
- Создан детальный отчёт FIXES_REPORT.md
